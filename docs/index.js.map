{"version":3,"file":"index.js","sources":["../src/EventBus.ts","../src/hidden.ts","../src/throttle.ts","../src/IfVisible.ts","../src/index.ts"],"sourcesContent":["export type FireableEvent = 'idle' | 'statusChanged' | 'blur' | 'focus' | 'wakeup'\nexport type Status = 'active' | 'idle' | 'hidden'\nexport interface Data {\n  status: Status\n}\nexport type FireableEventCallback = (data?: Data) => void\n\nexport class EventBus {\n  private store: { [event: string]: FireableEventCallback[] }\n\n  constructor() {\n    this.store = {}\n  }\n\n  public attach(event: FireableEvent, callback: FireableEventCallback) {\n    if (!this.store[event]) {\n      this.store[event] = []\n    }\n    this.store[event].push(callback)\n  }\n\n  public fire(event: FireableEvent, data?: Data) {\n    if (this.store[event]) {\n      this.store[event].forEach((callback) => {\n        callback(data)\n      })\n    }\n  }\n\n  public remove(event: FireableEvent, callback?: FireableEventCallback) {\n    if (!callback) {\n      delete this.store[event]\n    }\n    if (this.store[event]) {\n      this.store[event] = this.store[event].filter((savedCallback) => {\n        return callback !== savedCallback\n      })\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-member-access */\nexport type DocumentHidden = 'hidden' | 'mozHidden' | 'msHidden' | 'webkitHidden'\nexport type VisibilityChangeEvent =\n  | 'visibilitychange'\n  | 'mozHidden'\n  | 'mozvisibilitychange'\n  | 'msvisibilitychange'\n  | 'webkitvisibilitychange'\n\nlet documentHiddenProperty: DocumentHidden\nlet visibilityChangeEvent: VisibilityChangeEvent\n\nfunction resolveHiddenDetectionMethod(doc: Document) {\n  // lazily do this one time only\n  if (visibilityChangeEvent !== undefined) {\n    return\n  }\n\n  // Find correct browser events\n  if (doc.hidden !== undefined) {\n    documentHiddenProperty = 'hidden'\n    visibilityChangeEvent = 'visibilitychange'\n  } else if ((doc as any).mozHidden !== undefined) {\n    documentHiddenProperty = 'mozHidden'\n    visibilityChangeEvent = 'mozvisibilitychange'\n  } else if ((doc as any).msHidden !== undefined) {\n    documentHiddenProperty = 'msHidden'\n    visibilityChangeEvent = 'msvisibilitychange'\n  } else if ((doc as any).webkitHidden !== undefined) {\n    documentHiddenProperty = 'webkitHidden'\n    visibilityChangeEvent = 'webkitvisibilitychange'\n  }\n\n  if (documentHiddenProperty === undefined) {\n    throw new Error(\n      'Unable to determine browser event.  This may be an incompatible browser.  See https://github.com/rosskevin/ifvisible#browsers',\n    )\n  }\n}\n\nexport function isHidden(doc: Document) {\n  resolveHiddenDetectionMethod(doc)\n  return doc[documentHiddenProperty as DocumentHidden] as boolean\n}\n\nexport function resolveVisibilityChangeEvent(doc: Document) {\n  resolveHiddenDetectionMethod(doc)\n  return visibilityChangeEvent\n}\n","export type Throttled<T extends (...args: any) => any> = (...args: Parameters<T>) => ReturnType<T>\n\n/**\n * Creates a throttled {callback} will be called at most once per {limit} millisonds.\n *\n * @param callback - function\n * @param limit - milliseconds\n * @return - In limit mode, it will return last result of the {callback}, otherwise it will invoke the {callback}\n */\nexport function throttle<T extends (...args: any) => any>(\n  callback: T,\n  limit: number,\n): Throttled<T> {\n  let inThrottle: boolean\n  let lastResult: ReturnType<T>\n\n  return function (this: any, ...args): ReturnType<T> {\n    if (!inThrottle) {\n      inThrottle = true\n\n      setTimeout(() => (inThrottle = false), limit)\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      lastResult = callback.apply(this, args)\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return lastResult as any\n  }\n}\n","import { EventBus, FireableEvent, FireableEventCallback, Status } from './EventBus'\nimport { isHidden, resolveVisibilityChangeEvent } from './hidden'\nimport { throttle } from './throttle'\n\nexport interface IIdleInfo {\n  isIdle: boolean\n  idleFor: number\n  timeLeft: number\n  timeLeftPer: number\n}\n\ntype TimerCallback = () => void\nclass Timer {\n  private id: NodeJS.Timeout | string | number | undefined // NodeJS.Timer\n  private ifvInstance: IfVisible\n  private seconds: number\n  private callback: TimerCallback\n\n  constructor(ifvInstance: IfVisible, seconds: number, callback: TimerCallback) {\n    this.ifvInstance = ifvInstance\n    this.seconds = seconds\n    this.callback = callback\n    this.start()\n\n    this.ifvInstance.on('statusChanged', (data) => {\n      data?.status === 'active' ? this.start() : this.pause()\n    })\n  }\n\n  public stop() {\n    clearInterval(this.id)\n  }\n\n  public resume() {\n    this.start()\n  }\n\n  public pause() {\n    this.stop()\n  }\n\n  private start() {\n    if (this.id !== undefined) clearInterval(this.id)\n    this.id = setInterval(this.callback, this.seconds * 1000)\n  }\n}\n\ntype ListenerCallback = (...args: any) => void\nexport class IfVisible {\n  private status: Status = 'active'\n  private timers: NodeJS.Timeout[] = []\n  private idleTime = 30000\n  private idleStartedTime?: number\n  private win: Window\n  private doc: Document\n  private eventBus: EventBus\n  private winListeners?: { [key: string]: ListenerCallback }\n  private docListeners?: { [key: string]: ListenerCallback }\n  private focusListener?: FireableEventCallback\n  private throttleDuration = 500\n\n  constructor(win: Window, doc: Document) {\n    this.win = win\n    this.doc = doc\n    this.eventBus = new EventBus()\n\n    this.trackChange() // get initial status\n    this.reattachListeners() // attach all listeners with the default options\n  }\n\n  public on(event: FireableEvent, callback: FireableEventCallback): IfVisible {\n    this.eventBus.attach(event, callback)\n    return this\n  }\n\n  public off(event: FireableEvent, callback?: FireableEventCallback): IfVisible {\n    this.eventBus.remove(event, callback)\n    return this\n  }\n\n  public setIdleDuration(seconds: number): IfVisible {\n    this.idleTime = seconds * 1000\n    this.reattachListeners()\n    return this\n  }\n\n  public getIdleDuration(): number {\n    return this.idleTime\n  }\n\n  public getIdleInfo(): IIdleInfo {\n    const now = +new Date()\n    let res: IIdleInfo\n    const idleFor = this.idleStartedTime ? now - this.idleStartedTime : 0\n    if (this.status === 'idle') {\n      res = {\n        isIdle: true,\n        idleFor,\n        timeLeft: 0,\n        timeLeftPer: 100,\n      }\n    } else {\n      const timeLeft = this.idleStartedTime\n        ? this.idleStartedTime + this.idleTime - now\n        : this.idleTime\n      res = {\n        isIdle: false,\n        idleFor,\n        timeLeft,\n        timeLeftPer: parseFloat((100 - (timeLeft * 100) / this.idleTime).toFixed(2)),\n      }\n    }\n    return res\n  }\n\n  public setThrottleDuration(milliseconds: number): IfVisible {\n    this.throttleDuration = milliseconds\n    this.reattachListeners\n    return this\n  }\n\n  public idle(callback?: FireableEventCallback): IfVisible {\n    // used like a setter\n    if (callback) {\n      this.on('idle', callback)\n    } else {\n      this.status = 'idle'\n      this.eventBus.fire('idle')\n      this.eventBus.fire('statusChanged', { status: this.status })\n    }\n    return this\n  }\n\n  public blur(callback?: FireableEventCallback): IfVisible {\n    // used like a setter\n    if (callback) {\n      this.on('blur', callback)\n    } else {\n      this.status = 'hidden'\n      this.eventBus.fire('blur')\n      this.eventBus.fire('statusChanged', { status: this.status })\n    }\n    return this\n  }\n\n  public focus(callback?: FireableEventCallback): IfVisible {\n    // used like a setter\n    if (callback) {\n      this.on('focus', callback)\n    } else if (this.status !== 'active') {\n      this.status = 'active'\n      this.eventBus.fire('focus')\n      this.eventBus.fire('wakeup')\n      this.eventBus.fire('statusChanged', { status: this.status })\n    }\n    return this\n  }\n\n  public wakeup(callback?: FireableEventCallback): IfVisible {\n    // used like a setter\n    if (callback) {\n      this.on('wakeup', callback)\n    } else if (this.status !== 'active') {\n      this.status = 'active'\n      this.eventBus.fire('wakeup')\n      this.eventBus.fire('statusChanged', { status: this.status })\n    }\n    return this\n  }\n\n  public onEvery(seconds: number, callback: TimerCallback): Timer {\n    return new Timer(this, seconds, callback)\n  }\n\n  public now(check?: Status): boolean {\n    if (check !== undefined) {\n      return this.status === check\n    }\n    return this.status === 'active'\n  }\n\n  public getStatus() {\n    return this.status\n  }\n\n  private trackChange() {\n    if (isHidden(this.doc)) {\n      this.blur()\n    } else {\n      this.focus()\n    }\n  }\n\n  /**\n   * Helper broken out separately to allow for recognition of changes to option and reattachment with those taken into account.\n   */\n  private reattachListeners() {\n    //-----------------------------\n    // reap\n    if (\n      this.winListeners !== undefined &&\n      this.docListeners !== undefined &&\n      this.focusListener !== undefined\n    ) {\n      // detach all previous listeners first\n      for (const name of Object.getOwnPropertyNames(this.winListeners)) {\n        this.win.removeEventListener(name, this.winListeners[name])\n      }\n      for (const name of Object.getOwnPropertyNames(this.docListeners)) {\n        this.doc.removeEventListener(name, this.docListeners[name])\n      }\n\n      this.off('focus', this.focusListener) // reverse the attach process we do below\n    }\n\n    // wipe out old listener storage\n    this.winListeners = {}\n    this.docListeners = {}\n    this.focusListener = undefined\n\n    //-----------------------------\n    // instantiate listeners for doc and store them\n    this.docListeners[resolveVisibilityChangeEvent(this.doc) as 'visibilitychange'] = throttle(\n      this.trackChange,\n      this.throttleDuration,\n    )\n\n    for (const name of ['mousemove', 'mousedown', 'keyup', 'touchstart']) {\n      this.docListeners[name] = throttle(() => this.startIdleTimer(), this.throttleDuration)\n    }\n\n    // instantiate listeners for win and store them\n    this.winListeners['scroll'] = throttle(() => this.startIdleTimer(), this.throttleDuration)\n\n    // instantiate focus listener\n    this.focusListener = throttle(() => this.startIdleTimer(), this.throttleDuration)\n\n    //-----------------------------\n    // attach doc listeners\n    for (const name of Object.getOwnPropertyNames(this.docListeners)) {\n      this.doc.addEventListener(name, this.docListeners[name])\n    }\n\n    // attach win listeners\n    for (const name of Object.getOwnPropertyNames(this.winListeners)) {\n      this.win.addEventListener(name, this.winListeners[name])\n    }\n    // When page is focus without any event, it should not be idle.\n    this.focus(this.focusListener)\n\n    // finally kick everything off\n    this.startIdleTimer()\n  }\n\n  private startIdleTimer(event?: Event) {\n    // Prevents Phantom events.\n    if (event instanceof MouseEvent && event.movementX === 0 && event.movementY === 0) {\n      return\n    }\n\n    this.timers.map(clearTimeout)\n    this.timers.length = 0 // clear the array\n\n    if (this.status === 'idle') {\n      this.wakeup()\n    }\n\n    this.idleStartedTime = +new Date()\n\n    this.timers.push(\n      setTimeout(() => {\n        if (this.status === 'active' || this.status === 'hidden') {\n          this.idle()\n        }\n      }, this.idleTime),\n    )\n  }\n}\n","/* eslint-disable @typescript-eslint/no-unsafe-member-access */\nimport { IfVisible } from './IfVisible'\n\n// set library singleton and export for direct use\nexport const ifvisible = new IfVisible(window, document)\n\n// set window singleton (e.g. window.ifvisible) to the same instance\n;(window as any).ifvisible = ifvisible\n\nexport * from './EventBus'\nexport * from './IfVisible'\n"],"names":[],"mappings":"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"}